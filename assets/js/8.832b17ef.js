(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{251:function(t,s,n){"use strict";n.r(s);var a=n(28),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("这个文档是对B站源码model的归纳整理，随着时间的推移可能和最新代码有出入..."),n("br"),t._v("\n源码日期：2019年4月"),n("br"),t._v("\n整理日期：2020年4月起")])]),t._v(" "),n("p",[t._v("[TOC]")]),t._v(" "),n("h2",{attrs:{id:"弹幕"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#弹幕"}},[t._v("#")]),t._v(" 弹幕")]),t._v(" "),n("h3",{attrs:{id:"弹幕index和content"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#弹幕index和content"}},[t._v("#")]),t._v(" 弹幕index和content")]),t._v(" "),n("p",[n("strong",[t._v("model位置")])]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/interface/main/dm2/model/dm.pb.go-39行")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" DM "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ID         "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,1,opt,name=ID,proto3" json:"id"`')]),t._v("\n  Type       "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,2,opt,name=Type,proto3" json:"type"`')]),t._v("\n  Oid        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,3,opt,name=Oid,proto3" json:"oid"`')]),t._v("\n  Mid        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,4,opt,name=Mid,proto3" json:"mid"`')]),t._v("\n  Progress   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,5,opt,name=Progress,proto3" json:"progress"`')]),t._v("\n  Pool       "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,6,opt,name=Pool,proto3" json:"pool"`')]),t._v("\n  Attr       "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,7,opt,name=Attr,proto3" json:"attr"`')]),t._v("\n  State      "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,8,opt,name=State,proto3" json:"state"`')]),t._v("\n  Ctime      go_common_library_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,9,opt,name=Ctime,proto3,casttype=go-common/library/time.Time" json:"ctime"`')]),t._v("\n  Mtime      go_common_library_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,10,opt,name=Mtime,proto3,casttype=go-common/library/time.Time" json:"mtime"`')]),t._v("\n  Content    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Content                    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"bytes,11,opt,name=Content" json:"content,omitempty"`')]),t._v("\n  ContentSpe "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("ContentSpecial             "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"bytes,12,opt,name=ContentSpe" json:"content_special,omitempty"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 弹幕内容")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Content "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ID       "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,1,opt,name=ID,proto3" json:"id"`')]),t._v("\n  FontSize "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,2,opt,name=FontSize,proto3" json:"fontsize"`')]),t._v("\n  Color    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,3,opt,name=Color,proto3" json:"color"`')]),t._v("\n  Mode     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,4,opt,name=Mode,proto3" json:"mode"`')]),t._v("\n  IP       "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,5,opt,name=IP,proto3" json:"ip"`')]),t._v("\n  Plat     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,6,opt,name=Plat,proto3" json:"plat"`')]),t._v("\n  Msg      "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("                      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"bytes,7,opt,name=Msg,proto3" json:"msg"`')]),t._v("\n  Ctime    go_common_library_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,8,opt,name=Ctime,proto3,casttype=go-common/library/time.Time" json:"ctime"`')]),t._v("\n  Mtime    go_common_library_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,9,opt,name=Mtime,proto3,casttype=go-common/library/time.Time" json:"mtime"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("strong",[t._v("数据库分表以及sql位置")])]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/interface/main/dm2/dao/mysql.go——18行：查询弹幕index和content")]),t._v("\n_pageSize             "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一个xml最多1000条弹幕")]),t._v("\n_subjectSharding      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n_indexSharding        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 弹幕index表分表数")]),t._v("\n_contentSharding      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 弹幕内容表分表数")]),t._v("\n_idxByidSQL           "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT id,type,oid,mid,progress,state,pool,attr,ctime,mtime FROM dm_index_%03d WHERE type=? AND id=?"')]),t._v("\n_idxsByidSQL          "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT id,type,oid,mid,progress,state,pool,attr,ctime,mtime FROM dm_index_%03d WHERE type=? AND id IN(%s)"')]),t._v("\n_getIndexSQL          "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT id,type,oid,mid,progress,state,pool,attr,ctime,mtime FROM dm_index_%03d WHERE type=? AND oid=? AND state IN(0,6)"')]),t._v("\n_getContentSQL        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT dmid,fontsize,color,mode,ip,plat,msg,ctime,mtime FROM dm_content_%03d WHERE dmid=?"')]),t._v("\n_contentsSQL          "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT dmid,fontsize,color,mode,ip,plat,msg,ctime,mtime FROM dm_content_%03d WHERE dmid IN(%s)"')]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/job/main/dm2/dao/mysql.go——28行：弹幕数据通过异步job入库")]),t._v("\n_addIndexSQL        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT INTO dm_index_%03d(id,type,oid,mid,progress,state,pool,attr,ctime) VALUES(?,?,?,?,?,?,?,?,?)"')]),t._v("\n_addContentSQL      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"REPLACE INTO dm_content_%03d(dmid,fontsize,color,mode,ip,plat,msg,ctime) VALUES(?,?,?,?,?,?,?,?)"')]),t._v("\n")])])]),n("h3",{attrs:{id:"弹幕举报"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#弹幕举报"}},[t._v("#")]),t._v(" 弹幕举报")]),t._v(" "),n("p",[n("strong",[t._v("model位置")])]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\tReportReason "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"内容涉及违禁相关"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"内容涉及非法网站信息"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"内容涉及赌博诈骗信息"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"内容涉及人身攻击"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"内容涉及侵犯他人隐私"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"内容涉及垃圾广告"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"内容涉及引战"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"内容涉及视频剧透"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"恶意刷屏"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"视频不相关"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"其他"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"青少年不良信息"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tRptMsgTitle    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"举报处理结果通知"')]),t._v("\n\tRptMsgTemplate "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`您好，您在视频#{%s}{"http://www.bilibili.com/av%d"}中举报的弹幕『%s』已被删除，原因是『%s』，感谢您对bilibili社区秩序的维护，哔哩哔哩 (゜-゜)つロ 干杯~`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// const var")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// up主操作")]),t._v("\n\tStatUpperInit   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// up主未处理")]),t._v("\n\tStatUpperIgnore "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// up主已忽略")]),t._v("\n\tStatUpperDelete "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// up主已删除")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 管理员操作")]),t._v("\n\tStatFirstInit        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 待一审")]),t._v("\n\tStatFirstDelete      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一审删除")]),t._v("\n\tStatSecondInit       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 待二审")]),t._v("\n\tStatSecondIgnore     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 二审忽略")]),t._v("\n\tStatSecondDelete     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 二审删除")]),t._v("\n\tStatFirstIgnore      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一审忽略")]),t._v("\n\tStatSecondAutoDelete "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 二审脚本删除")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理结果通知")]),t._v("\n\tNoticeUnsend "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 未通知用户")]),t._v("\n\tNoticeSend   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 已通知用户")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 举报原因")]),t._v("\n\tReportReasonProhibited  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 违禁")]),t._v("\n\tReportReasonPorn        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 色情")]),t._v("\n\tReportReasonFraud       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 赌博诈骗")]),t._v("\n\tReportReasonAttack      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 人身攻击")]),t._v("\n\tReportReasonPrivate     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 隐私")]),t._v("\n\tReportReasonAd          "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 广告")]),t._v("\n\tReportReasonWar         "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 引战")]),t._v("\n\tReportReasonSpoiler     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 剧透")]),t._v("\n\tReportReasonMeaningless "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 刷屏")]),t._v("\n\tReportReasonUnrelated   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 视频不相关")]),t._v("\n\tReportReasonOther       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 其他")]),t._v("\n\tReportReasonTeenagers   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 青少年不良信息")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Report dm report info")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Report "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tID      "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"id"`')]),t._v("      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 主键id")]),t._v("\n\tCid     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"cid"`')]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 视频id")]),t._v("\n\tDid     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"dmid"`')]),t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 弹幕id")]),t._v("\n\tUID     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"uid"`')]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 举报用户的id")]),t._v("\n\tReason  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int8")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"reason"`')]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 举报原因类型")]),t._v("\n\tContent "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"content"`')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 举报内容：reason为其它时有值")]),t._v("\n\tCount   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"count"`')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 被举报次数")]),t._v("\n\tState   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int8")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"state"`')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 举报状态")]),t._v("\n\tUpOP    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int8")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"up_op"`')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// up主操作")]),t._v("\n\tScore   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"score"`')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 举报分")]),t._v("\n\tRpTime  time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"rp_time"`')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 举报时间")]),t._v("\n\tCtime   time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"ctime"`')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 插入时间")]),t._v("\n\tMtime   time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"mtime"`')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新时间")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// User report user info")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" User "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tID      "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"id"`')]),t._v("\n\tDid     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"dmid"`')]),t._v("\n\tUID     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"uid"`')]),t._v("\n\tReason  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int8")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"reason"`')]),t._v("\n\tState   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int8")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"state"`')]),t._v("\n\tContent "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"content"`')]),t._v("\n\tCtime   time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"ctime"`')]),t._v("\n\tMtime   time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"mtime"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("strong",[t._v("数据库分表以及sql位置")])]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/interface/main/dm/dao/mysql_report.go")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t_rptSharding     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n\t_rptUserSharding "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n\t_rptLogSharding  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n\t_insertRpt       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT INTO dm_report_%d (cid,dmid,uid,reason,content,count,state,up_op,rp_time,score,ctime,mtime) VALUES(?,?,?,?,?,?,?,?,?,?,?,?)"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('" ON DUPLICATE KEY UPDATE uid=?,reason=?,state=?,content=?,count=count+1,rp_time=?,score=score+?"')]),t._v("\n\t_selectRpt         "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT id,cid,dmid,uid,reason,content,count,state,up_op,score,rp_time,ctime,mtime FROM dm_report_%d WHERE dmid=?"')]),t._v("\n\t_updateRptUPOp     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE dm_report_%d SET up_op=? WHERE dmid=?"')]),t._v("\n\t_updateRpt         "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE dm_report_%d SET state=? WHERE dmid=?"')]),t._v("\n\t_insertUser        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT IGNORE INTO dm_report_user_%d (dmid,uid,reason,state,content,ctime,mtime) VALUES(?,?,?,?,?,?,?)"')]),t._v("\n\t_selectRptLog      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT id,dmid,adminid,reason,result,remark,elapsed,ctime,mtime FROM dm_report_admin_log_%d WHERE dmid=? ORDER BY mtime"')]),t._v("\n\t_insertRptLog      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT INTO dm_report_admin_log_%d (dmid,adminid,reason,result,remark,elapsed) VALUES (?,?,?,?,?,?)"')]),t._v("\n\t_selectRptUser     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT id,dmid,uid,reason,state,ctime,mtime FROM dm_report_user_%d WHERE dmid=? AND state=?"')]),t._v("\n\t_updateRptUserStat "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE dm_report_user_%d SET state=? WHERE dmid=? AND state!=?"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h2",{attrs:{id:"动态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#动态"}},[t._v("#")]),t._v(" 动态")]),t._v(" "),n("h3",{attrs:{id:"动态卡片dycard"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#动态卡片dycard"}},[t._v("#")]),t._v(" 动态卡片DyCard")]),t._v(" "),n("p",[n("strong",[t._v("model位置")])]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/interface/main/space/model/dynamic.go-11行")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" DyCard "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tCard json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RawMessage "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"card"`')]),t._v("\n\tDesc "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tUID         "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"uid"`')]),t._v("\n\t\tType        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("          "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"type"`')]),t._v("\n\t\tACL         "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("          "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"acl"`')]),t._v("\n\t\tRid         "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"rid"`')]),t._v("\n\t\tView        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"view"`')]),t._v("\n\t\tRepost      "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"repost"`')]),t._v("\n\t\tComment     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"comment"`')]),t._v("\n\t\tLike        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"like"`')]),t._v("\n\t\tIsLiked     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"is_liked"`')]),t._v("\n\t\tDynamicID   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"dynamic_id"`')]),t._v("\n\t\tCommentID   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"comment_id"`')]),t._v("\n\t\tTimestamp   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"timestamp"`')]),t._v("\n\t\tPreDyID     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"pre_dy_id"`')]),t._v("\n\t\tOrigDyID    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"orig_dy_id"`')]),t._v("\n\t\tOrigType    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("          "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"orig_type"`')]),t._v("\n\t\tRType       "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("          "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"r_type"`')]),t._v("\n\t\tInnerID     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"inner_id"`')]),t._v("\n\t\tUserProfile "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("UserProfile "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"user_profile,omitempty"`')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"desc"`')]),t._v("\n\tExtension "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("DyExtension "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"extension,omitempty"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("strong",[t._v("数据库分表以及sql位置")])]),t._v(" "),n("p",[t._v("未找到")]),t._v(" "),n("h2",{attrs:{id:"关注和粉丝"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关注和粉丝"}},[t._v("#")]),t._v(" 关注和粉丝")]),t._v(" "),n("p",[n("strong",[t._v("model位置")])]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/service/main/relation/model/model.pb.go——235行")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Following "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tMid                  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,1,opt,name=mid,proto3" json:"mid"`')]),t._v("\n\tAttribute            "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint32")]),t._v("                      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,2,opt,name=attribute,proto3" json:"attribute"`')]),t._v("\n\tSource               "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint32")]),t._v("                      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,3,opt,name=source,proto3" json:"-"`')]),t._v("\n\tCTime                go_common_library_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,4,opt,name=ctime,proto3,casttype=go-common/library/time.Time" json:"-"`')]),t._v("\n\tMTime                go_common_library_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,5,opt,name=mtime,proto3,casttype=go-common/library/time.Time" json:"mtime"`')]),t._v("\n\tTag                  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v("                     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,6,rep,packed,name=tag,proto3" json:"tag"`')]),t._v("\n\tSpecial              "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`protobuf:"varint,7,opt,name=special,proto3" json:"special"`')]),t._v("\n\tXXX_NoUnkeyedLiteral "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("                    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"-"`')]),t._v("\n\tXXX_unrecognized     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),t._v("                      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"-"`')]),t._v("\n\tXXX_sizecache        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int32")]),t._v("                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`json:"-"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("strong",[t._v("数据库分表以及sql位置")])]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app/service/main/relation/dao/mysql.go")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t_shard        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v("\n\t_statShard    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n\t_tagShard     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n\t_tagUserShard "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v("\n\t_defaultTag   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"默认分组"')]),t._v("\n\t_specialTag   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"特别关注"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// relation")]),t._v("\n\t_getFollowingSQL   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT fid,attribute,mtime FROM user_relation_mid_%03d WHERE mid=? AND status=0"')]),t._v("\n\t_getFollowingInSQL "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT fid,attribute,mtime FROM user_relation_mid_%03d WHERE mid=? AND status=0 AND fid IN (%s)"')]),t._v("\n\t_addFollowingSQL   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT INTO user_relation_mid_%03d (mid,fid,attribute,source,status, ctime,mtime) VALUES (?,?,?,?,0,?,?) ON DUPLICATE KEY UPDATE attribute=attribute|?,source=?,status=0,mtime=?"')]),t._v("\n\t_setFollowingSQL   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE user_relation_mid_%03d SET attribute=?,source=?,status=?,mtime=? WHERE mid=? AND fid=?"')]),t._v("\n\t_getFollowersSQL   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT mid,attribute,mtime FROM user_relation_fid_%03d WHERE fid=? AND status=0 AND attribute IN (2,6) ORDER BY mtime DESC LIMIT 1000"')]),t._v("\n\t_addFollowersSQL   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT INTO user_relation_fid_%03d (mid,fid,attribute,source,status,ctime,mtime) VALUES (?,?,?,?,0,?,?) ON DUPLICATE KEY UPDATE attribute=attribute|?,source=?,status=0,mtime=?"')]),t._v("\n\t_setFollowersSQL   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE user_relation_fid_%03d SET attribute=?,source=?,status=?,mtime=? WHERE fid=? AND mid=?"')]),t._v("\n\t_getRelationSQL    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT attribute FROM user_relation_mid_%03d WHERE mid=? AND fid=? AND status=0 LIMIT 1"')]),t._v("\n\t_addStatIgnoreSQL  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT IGNORE INTO user_relation_stat_%02d (mid,following,whisper,black,follower,ctime,mtime) VALUES (?,?,?,?,?,?,?)"')]),t._v("\n\t_addStatSQL        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE user_relation_stat_%02d SET following=following+?,whisper=whisper+?,black=black+?,follower=follower+?,mtime=? WHERE mid=?"')]),t._v("\n\t_setStatSQL        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE user_relation_stat_%02d SET following=?,whisper=?,black=?,follower=?,mtime=? WHERE mid=?"')]),t._v("\n\t_getStatSQL        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT mid,following,whisper,black,follower, ctime,mtime from user_relation_stat_%02d where mid=?"')]),t._v("\n\t_getTxStatSQL      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT mid,following,whisper,black,follower,ctime,mtime from user_relation_stat_%02d where mid=? FOR UPDATE"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// relation tag table")]),t._v("\n\t_getTagsSQL    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT id,name,status,mtime FROM user_relation_tag_%02d WHERE mid=? AND status=0"')]),t._v("\n\t_addTagSQL     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT INTO user_relation_tag_%02d (mid,name,status,ctime,mtime) VALUES (?,?,0,?,?)"')]),t._v("\n\t_delTagSQL     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DELETE FROM user_relation_tag_%02d WHERE id=? AND mid=?"')]),t._v("\n\t_setTagNameSQL "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE user_relation_tag_%02d SET name=?,mtime=? WHERE id=?"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// relation tag user table")]),t._v("\n\t_getTagUserSQL      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT fid,tag FROM user_relation_tag_user_%03d WHERE mid=?"')]),t._v("\n\t_getUsersTagSQL     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT fid,tag FROM user_relation_tag_user_%03d WHERE mid=? AND fid IN(%s)"')]),t._v("\n\t_getTagsByMidFidSQL "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT fid,tag,mtime FROM user_relation_tag_user_%03d WHERE mid=? and fid=?"')]),t._v("\n\t_addTagUserSQL      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT INTO user_relation_tag_user_%03d (mid,fid,tag,ctime,mtime) VALUES (?,?,?,?,?) ON DUPLICATE KEY UPDATE tag=?"')]),t._v("\n\t_setTagUserSQL      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UPDATE user_relation_tag_user_%03d SET tag=?,mtime=? WHERE mid=? AND fid=?"')]),t._v("\n\t_delTagUserSQL      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DELETE FROM user_relation_tag_user_%03d WHERE mid=? AND fid=?"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// relation monitor")]),t._v("\n\t_loadMonitorSQL "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT mid FROM user_relation_monitor"')]),t._v("\n\t_addMonitorSQL  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT IGNORE INTO user_relation_monitor (mid,ctime,mtime) VALUES (?,?,?)"')]),t._v("\n\t_delMonitorSQL  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DELETE FROM user_relation_monitor WHERE mid = ?"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// relation achieve")]),t._v("\n\t_hasReachAchieve "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT count(1) FROM user_addit WHERE mid=? AND achieve_flags>=?"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// follower notify")]),t._v("\n\t_getFollowerNotifySettingSQL "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT disable_follower_notify FROM user_addit where mid=?"')]),t._v("\n\t_enableFollowerNotifySQL     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT INTO user_addit (mid, disable_follower_notify) VALUES(?, 0) ON DUPLICATE KEY UPDATE disable_follower_notify=0"')]),t._v("\n\t_disableFollowerNotifySQL    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INSERT INTO user_addit (mid, disable_follower_notify) VALUES(?, 1) ON DUPLICATE KEY UPDATE disable_follower_notify=1"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Followers get user's latest 1000 followers(attribute = AttrFollowing), order by mtime desc.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Dao"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Followers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mid "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("model"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Following"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" rows "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Rows\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" rows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Query")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fmt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Sprintf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_getFollowersSQL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tlog"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"d.query(%s).hit(%d).mid(%d) error(%v)"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _getFollowersSQL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("defer")]),t._v(" rows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" rows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("new")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Following"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Scan")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Mid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Attribute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MTime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tlog"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"row.Scan() error(%v)"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\tres "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\tres "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\terr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Err")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"模板"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模板"}},[t._v("#")]),t._v(" 模板")]),t._v(" "),n("h3",{attrs:{id:"模板-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模板-2"}},[t._v("#")]),t._v(" 模板")]),t._v(" "),n("p",[n("strong",[t._v("model位置")])]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[t._v("\n")])])]),n("p",[n("strong",[t._v("数据库分表以及sql位置")])]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);